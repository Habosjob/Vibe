# IMPROVEMENTS

## 1) Функционал
- Добавить API-слой (FastAPI) поверх SQLite/Parquet для выборок по `SECID`, периоду и источнику (cache/network/stale_cache).
  - **Профит:** аналитика и интеграции смогут читать данные без прямого доступа к файлам/БД.
- Добавить режим `--dry-run` с валидацией доступности MOEX, endpoint health и прогнозом длительности без записи артефактов.
  - **Профит:** быстрый preflight перед запуском по расписанию.
- Добавить уведомления в Telegram/Slack при деградации SLA или росте DQ-warning.
  - **Профит:** проблемы замечаются сразу, не нужно вручную смотреть логи.

## 2) Оптимизация
- Вынести конфигурацию таймаутов/retry/circuit-breaker в единый конфиг (YAML/env), включая разные профили для day/intraday.
  - **Профит:** проще тюнинг в проде без правок кода.
- Перевести тяжёлые merge/feature steps в инкрементальные операции по watermark (обновлять только изменённые SECID).
  - **Профит:** уменьшение времени details-этапа и нагрузки на MOEX.
- Добавить регулярный `VACUUM`/`ANALYZE` для SQLite и контроль роста таблиц history.
  - **Профит:** стабильная производительность при длительной эксплуатации.

## 3) Выделение функций в сервисы
- `rates-ingest`: только fetch + parse + DQ baseline + кеширование дневного CSV.
  - **Профит:** изоляция источника, отдельный SLA и простой дневной cron.
- `details-enricher`: только enrichment, параллельные details-запросы, stale-cache fallback, parquet/sqlite/xlsx materialization.
  - **Профит:** независимое масштабирование I/O-heavy этапа.
- `quotes-snapshotter`: только intraday snapshot с частым расписанием и короткими таймаутами.
  - **Профит:** частые котировки не блокируют дневной пайплайн и не влияют на batch-обогащение.
- Дополнительно: оркестратор (scheduler) с явными контрактами между сервисами (таблица статусов запусков + idempotency key).
  - **Профит:** управляемость, повторяемость запусков, прозрачная диагностика.
