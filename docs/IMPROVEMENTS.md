# IMPROVEMENTS

## Осознанно не реализовано
- Уведомления Telegram/Slack (по вашему условию).
- **П.1 scheduler-service** как отдельный orchestrator пока не выносился в отдельный процесс/репозиторий.

## Реализовано (пп. 2–5)
2. **Cache-policy вынесен в отдельный модуль** `cache_policy.py`.
   - Что сделано: TTL деталей, интервалы snapshot, discovery retry/backoff и circuit-breaker лимиты читаются централизованно из env.
   - Профит: можно менять эксплуатационные параметры без правок бизнес-логики.

3. **Incremental-details по diff-списку бумаг**.
   - Что сделано: после CSV-парсинга считается diff (добавленные/удалённые бумаги), а stage details обновляет сетью в первую очередь только изменившиеся SECID; для остальных использует cache/stale-cache.
   - Профит: заметное ускорение stage 3 на больших наборах, меньше сетевой нагрузки.

4. **Read-model для UI/API**.
   - Что сделано: собирается `bonds_read_model` (обогащённая витрина + последние intraday-котировки), API `/bonds` читает её в приоритете.
   - Профит: быстрые ответы API и более стабильная нагрузка на SQLite.

5. **Разделение по сервисам**.
   - Что сделано: поддерживаются независимые entrypoint-сервисы `rates_ingest`, `details_enricher`, `quotes_snapshotter`, `api_service`, с общей кодовой базой.
   - Профит: можно разносить по разным процессам/контейнерам и масштабировать по профилю нагрузки.

## Предлагаемые следующие доработки (кратко + профит)
1. **Вынести SQL в репозиторные слои (`repositories/`)**.
   - Профит: проще тестировать, меньше связности между ETL-логикой и хранением.
2. **Добавить профили выполнения (`--profile full|incremental|offline`)**.
   - Профит: предсказуемое поведение пайплайна для разных operational-сценариев.
3. **Сделать structured-logging (JSON) + correlation_id по run_id/secid**.
   - Профит: удобнее трассировка инцидентов в ELK/Loki.
4. **Добавить lightweight метрики Prometheus (latency, error-rate, cache-hit)**.
   - Профит: алерты на деградацию до того, как это заметит пользователь.
5. **Покрыть критичные участки unit/integration тестами (diff, incremental, read-model)**.
   - Профит: меньше регрессий при изменениях pipeline.
